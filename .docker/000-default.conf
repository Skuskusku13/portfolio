<VirtualHost *:80>
    ServerName dlyhub.com
    DocumentRoot /usr/local/apache2/htdocs

    <Directory /usr/local/apache2/htdocs/>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.html

        # 1. Mise en cache agressive pour les assets (JS, CSS, images, fiches)
        # Puisque les noms de fichiers sont hashés, on peut les mettre en cache 1 an
        <Directory "/usr/local/apache2/htdocs/assets">
            Header set Cache-Control "max-age=31536000, public, immutable"
        </Directory>

        # 2. Gestion du cache pour les fichiers racines (HTML, robots, manifest)
        <FilesMatch "\.(html|txt|webmanifest)$">
            Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
        </FilesMatch>

        # 3. Désactiver la mise en cache spécifique pour robots.txt
        <Files "robots.txt">
            Header set Cache-Control "no-cache, no-store, must-revalidate"
        </Files>

        # Activation du routing côté client pour les SPA
        RewriteEngine On
        RewriteBase /
        
        # Ne pas réécrire si le fichier ou le dossier existe réellement
        RewriteCond %{REQUEST_FILENAME} -f [OR]
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule ^ - [L]

        # Réécrire tout le reste vers index.html
        RewriteRule ^ index.html [L]
    </Directory>
</VirtualHost>